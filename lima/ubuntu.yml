images:
  - location: "https://cloud-images.ubuntu.com/releases/plucky/release/ubuntu-25.04-server-cloudimg-amd64.img"
    arch: "x86_64"
  - location: "https://cloud-images.ubuntu.com/releases/plucky/release/ubuntu-25.04-server-cloudimg-arm64.img"
    arch: "aarch64"

vmType: "vz"

# Enable Rosetta for Linux.
# Hint: try `softwareupdate --install-rosetta` if Lima gets stuck at `Installing rosetta...`
# Register rosetta to /proc/sys/fs/binfmt_misc
rosetta:
  enabled: true
  binfmt: true

user:
  name: "ebpf"

mounts:
  - location: "~/Documents/Code/Personal/nflux"
    writable: true

memory: "2GiB"
cpus: 4
disk: "25GiB"

provision:
  - mode: system
    script: |
      #!/bin/bash
      set -eux -o pipefail
      apt update -y
      apt install -y vim gcc make clang bpftool bpftrace linux-headers-$(uname -r) protobuf-compiler

  - mode: user
    script: |
      #!/bin/bash
      set -eux -o pipefail
      curl https://sh.rustup.rs -sSf | sh -s -- -y
      source $HOME/.cargo/env
      rustup install stable && rustup toolchain install nightly --component rust-src
      rustup component add rust-analyzer
      rustup default nightly
      cargo install bpf-linker
