pkgname=nflux
pkgver=1.0.0
pkgrel=1
pkgdesc="Simple network monitoring agent tool powered by eBPF & Rust"
arch=('x86_64')
url="https://github.com/containerscrew/nflux"
license=('GPL3')
depends=('systemd')
makedepends=('rust' 'cargo')
#options=('!debug' '!strip')
source=()
sha256sums=()
install="nflux.install"

build() {
    cargo build --release --locked
}

check() {
    cargo test --release --locked || echo "Tests skipped"
}

package() {
    cd "$srcdir/.."
    install -Dm755 "../target/release/nflux" "$pkgdir/usr/bin/nflux"
    install -Dm644 "system/nflux.service" "$pkgdir/usr/lib/systemd/system/nflux.service"
    install -Dm644 "../nflux.toml.example" "$pkgdir/etc/nflux/nflux.toml"
    install -Dm644 "system/nflux.logrotate" "$pkgdir/etc/logrotate.d/nflux"
    install -d -m755 "$pkgdir/var/log/nflux"
}

